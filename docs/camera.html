<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>摄像头轮播监控 Demo</title>
<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background-color: #1a1a1a;
        color: #e0e0e0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
    }
    .carousel-widget {
        width: 640px; /* 16:9 aspect ratio */
        height: 460px;
        background-color: #2c2c2e;
        border: 1px solid #444;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        padding: 16px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    .widget-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }
    .widget-header h4 {
        margin: 0;
        font-weight: 600;
        font-size: 1.1em;
    }
    .status {
        display: flex;
        align-items: center;
        font-size: 0.9em;
    }
    .status-light {
        width: 8px;
        height: 8px;
        background-color: #34c759; /* Green light */
        border-radius: 50%;
        margin-right: 6px;
        box-shadow: 0 0 5px #34c759;
    }
    .video-area {
        width: 100%;
        height: 360px; /* 16:9 aspect ratio content area */
        background-color: #000;
        border-radius: 6px;
        position: relative;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #555;
        font-size: 2em;
        transition: background-color 0.5s ease;
    }
    .video-area .cam-name {
        transition: opacity 0.5s ease-in-out;
    }
    .nav-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background-color: rgba(44, 44, 46, 0.5);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 20px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s;
    }
    .video-area:hover .nav-arrow {
        opacity: 1;
    }
    .nav-arrow.prev { left: 10px; }
    .nav-arrow.next { right: 10px; }

    .controls-bar {
        display: flex;
        justify-content: center;
        align-items: center;
        padding-top: 16px;
        gap: 12px;
    }
    .play-pause-btn {
        background: none;
        border: 2px solid #888;
        color: #888;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        font-size: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }
    .play-pause-btn:hover {
        border-color: white;
        color: white;
    }
    .dots-container {
        display: flex;
        gap: 12px;
    }
    .dot {
        width: 12px;
        height: 12px;
        background-color: #555;
        border-radius: 50%;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    .dot.active::after {
        content: '';
        position: absolute;
        top: 0; left: 0;
        height: 100%;
        width: 100%;
        background-color: #007aff;
        border-radius: 50%;
        animation: fill-dot 5s linear forwards;
    }
    @keyframes fill-dot {
        from { transform: scale(0); }
        to { transform: scale(1); }
    }
</style>
</head>
<body>

<div class="carousel-widget">
    <div class="widget-header">
        <h4 id="widget-title">摄像头监控</h4>
        <div class="status">
            <div class="status-light"></div>
            <span id="status-text">自动轮播中...</span>
        </div>
    </div>
    <div class="video-area">
        <span class="cam-name" id="cam-name-display"></span>
        <button class="nav-arrow prev" id="prev-btn">&#10094;</button>
        <button class="nav-arrow next" id="next-btn">&#10095;</button>
    </div>
    <div class="controls-bar">
        <div class="dots-container" id="dots-container"></div>
        <button class="play-pause-btn" id="play-pause-btn">&#10074;&#10074;</button>
    </div>
</div>

<script>
    const cameras = [
        { name: '摄像头 3-1 区域' },
        { name: '摄像头 4-1 区域' },
        { name: '摄像头 5-2 区域' },
        { name: '仓库入口摄像头' },
        { name: '生产线末端' }
    ];
    const ROTATION_INTERVAL = 5000; // 轮播间隔5秒

    let currentCamIndex = 0;
    let isPlaying = true;
    let intervalId = null;

    const camNameDisplay = document.getElementById('cam-name-display');
    const dotsContainer = document.getElementById('dots-container');
    const playPauseBtn = document.getElementById('play-pause-btn');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const statusText = document.getElementById('status-text');

    // 初始化
    function init() {
        // 创建导航点
        cameras.forEach((_, index) => {
            const dot = document.createElement('div');
            dot.classList.add('dot');
            dot.dataset.index = index;
            dot.addEventListener('click', () => jumpToCam(index));
            dotsContainer.appendChild(dot);
        });

        // 绑定事件
        playPauseBtn.addEventListener('click', togglePlayPause);
        prevBtn.addEventListener('click', showPrevCam);
        nextBtn.addEventListener('click', showNextCam);

        // 开始轮播
        updateDisplay();
        startRotation();
    }

    function updateDisplay() {
        // 更新摄像头名称
        camNameDisplay.style.opacity = 0;
        setTimeout(() => {
            camNameDisplay.textContent = cameras[currentCamIndex].name;
            camNameDisplay.style.opacity = 1;
        }, 500);

        // 更新导航点状态
        document.querySelectorAll('.dot').forEach((dot, index) => {
            dot.classList.remove('active');
            if (index === currentCamIndex) {
                dot.classList.add('active');
            }
        });

        // 如果正在播放，重启动画
        if (isPlaying) {
            const activeDot = document.querySelector('.dot.active');
            activeDot.style.animation = 'none';
            // 强制浏览器重新渲染
            activeDot.offsetHeight; 
            activeDot.style.animation = `fill-dot ${ROTATION_INTERVAL / 1000}s linear forwards`;
        }
    }

    function startRotation() {
        if (intervalId) clearInterval(intervalId);
        intervalId = setInterval(showNextCam, ROTATION_INTERVAL);
        isPlaying = true;
        playPauseBtn.innerHTML = '&#10074;&#10074;'; // Pause icon
        statusText.textContent = '自动轮播中...';
        updateDisplay();
    }

    function stopRotation() {
        clearInterval(intervalId);
        intervalId = null;
        isPlaying = false;
        playPauseBtn.innerHTML = '&#9658;'; // Play icon
        statusText.textContent = '已暂停';
        const activeDot = document.querySelector('.dot.active');
        if (activeDot) {
            activeDot.style.animationPlayState = 'paused';
        }
    }

    function togglePlayPause() {
        if (isPlaying) {
            stopRotation();
        } else {
            startRotation();
        }
    }

    function showNextCam() {
        currentCamIndex = (currentCamIndex + 1) % cameras.length;
        updateDisplay();
    }

    function showPrevCam() {
        currentCamIndex = (currentCamIndex - 1 + cameras.length) % cameras.length;
        updateDisplay();
    }

    function jumpToCam(index) {
        currentCamIndex = index;
        updateDisplay();
        // 点击跳转后，如果正在播放，则重置计时器
        if (isPlaying) {
            startRotation();
        }
    }
    
    // 启动
    init();

</script>
</body>
</html>